#!/usr/bin/env bash

if ! command -v fzf >/dev/null 2>&1; then
  echo "Error: fzf is required for co" >&2
  exit 1
fi

if ! command -v codex >/dev/null 2>&1; then
  echo "Error: codex CLI is not on PATH" >&2
  exit 1
fi

mapfile -t options <<'OPTIONS'
Default - GPT-5.1 Codex:::codex --yolo --search --model gpt-5.1-codex -c model_reasoning_effort="medium" -c model_verbosity="medium"
Reasoning - GPT-5.1 Codex:::codex --yolo --search --model gpt-5.1-codex -c model_reasoning_effort="high" -c model_verbosity="medium"
Fast - GPT-5.1 Codex Mini:::codex --yolo --search --model gpt-5.1-codex-mini -c model_reasoning_effort="medium" -c model_verbosity="low"
Chat - GPT-5.1 :::codex --yolo --search --model gpt-5.1 -c model_reasoning_effort="medium" -c model_verbosity="medium"
Chat Reasoning - GPT-5.1 :::codex --yolo --search --model gpt-5.1 -c model_reasoning_effort="high" -c model_verbosity="medium"
Chat Fast - GPT-5.1 :::codex --yolo --search --model gpt-5.1 -c model_reasoning_effort="medium" -c model_verbosity="low"
OPTIONS

if [ ${#options[@]} -eq 0 ]; then
  echo "Error: no Codex profiles defined" >&2
  exit 1
fi

selection=$(printf '%s
' "${options[@]}" | fzf --reverse --tiebreak=begin --prompt "codex> " --header "Select a Codex profile (Enter to run)" --height 40% --border)
status=$?

if [ $status -ne 0 ] || [ -z "$selection" ]; then
  exit $status
fi

profile_command=${selection#*:::}

extra_args=""
if [ $# -gt 0 ]; then
  for arg in "$@"; do
    extra_args+=" $(printf '%q' "$arg")"
  done
fi

printf 'Running %s\n' "$selection"
eval "$profile_command$extra_args"
