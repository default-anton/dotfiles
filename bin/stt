#!/usr/bin/env bash

set -euo pipefail

FILE_PATH="${1:-}"

if [ ! -f "${FILE_PATH}" ]; then
  FILE_PATH=/tmp/recording.mp3
  sox -q -d -c 1 -t mp3 -C 128.2 "${FILE_PATH}" rate 16k
fi

trap "rm -f ${FILE_PATH}" EXIT

curl https://api.groq.com/openai/v1/audio/transcriptions \
  -H "Authorization: Bearer ${GROQ_API_KEY}" \
  -H "Content-Type: multipart/form-data" \
  -F file="@${FILE_PATH}" \
  -F model="whisper-large-v3" \
  -F temperature="0.0" \
  -F response_format="text" \
  -F language="en" \
  -F prompt="Hey, I've been looking at the project implementation details and thinking about our approach. You know, we might need to refactor some of the core modules to improve performance. What are your thoughts on using async patterns for the new features?"
